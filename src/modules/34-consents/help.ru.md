# Согласия и контуры доступа

## О модуле

Модуль управления согласиями (Consents) обеспечивает полный контроль над тем, кто и на каких условиях может видеть, получать и экспортировать данные клиентов Multi-Family Office.

## Ключевые возможности

### Согласия (Consents)
- Выдача согласий по уровням: client, household, entity, account, document
- Типы разрешений: view, download, export, api access
- Срок действия и автоматическая экспирация
- Поддержка client-safe режима для ограниченного доступа

### Запросы доступа (Access Requests)
- Внешние консультанты запрашивают доступ
- SLA на обработку запросов
- Workflow одобрения/отклонения
- Автоматическое создание consent при approve

### Политики шаринга (Sharing Policies)
- Правила по умолчанию для документов и отчетов
- Client-safe constraints для чувствительных данных
- Ограничения по ролям и тегам документов
- Обязательный watermark для аудиторских документов

### Data Rooms
- Пакеты документов для аудиторов и юристов
- Trustee review комплекты
- Контроль аудитории и сроков
- Watermark на все документы в комнате

### Отзыв доступа (Revocations)
- Мгновенный отзыв любого согласия
- Полная история отзывов
- Audit trail всех изменений

## Как это работает

### Создание согласия
1. Выберите субъекта (пользователь, advisor, клиент)
2. Укажите scope (household, entity, account, document)
3. Определите разрешения (view, download, export, api)
4. Установите срок действия
5. Опционально: включите client-safe режим

### Обработка запроса доступа
1. Внешний advisor создает запрос
2. RM или Compliance получает уведомление
3. Проверка обоснования запроса
4. Approve создает consent, Reject отклоняет
5. Все действия логируются в audit

### Работа с Data Room
1. Создайте комнату с целью (audit, legal, trustee)
2. Добавьте документы и отчеты
3. Пригласите участников (создается consent)
4. Отслеживайте просмотры и загрузки
5. Закройте комнату по завершении

### Применение политик
Политики шаринга проверяются автоматически при:
- Скачивании документа из Vault
- Просмотре отчета внешним пользователем
- API запросах к данным
- Создании нового consent

## Интеграции

### Document Vault
При скачивании документа проверяется:
- Наличие активного consent
- Соответствие sharing policy
- Требование watermark

### Reports Viewer
Client-safe политики применяются к:
- Выбору отображаемых данных
- Экспорту отчетов
- Шарингу с клиентами

### Client Portal
Клиенты видят только:
- Документы с явным consent
- Отчеты в client-safe режиме
- Свои Data Rooms

## RBAC

| Роль | Права |
|------|-------|
| Owner/Admin | Полное управление |
| Compliance | Политики, audit, requests |
| RM | Создание requests, data rooms |
| External Advisor | Создание requests, доступ к разрешенным rooms |
| Client | Просмотр своих consents (read-only) |

## Audit Trail

Логируются все события:
- Создание и изменение consent
- Approve/reject запросов
- Обновление политик
- Создание и закрытие data rooms
- Добавление/удаление items
- Отзыв доступа
- Блокировка download (опционально)

## Дисклеймер

> ⚠️ **Важно**: Доступы и согласия в MVP демонстрационные. Для production требуется юридическая проработка и инфраструктура.

Функционал не заменяет:
- Юридические соглашения о конфиденциальности
- Compliance политики организации
- Требования регуляторов
- Инфраструктуру безопасности enterprise-уровня
