# Sandbox — Песочница интеграций

## Обзор

Модуль **Sandbox** предоставляет безопасную среду для тестирования интеграций без влияния на production данные. Идеально подходит для Ops-команд и разработчиков при настройке новых подключений.

> **Важно:** Sandbox в MVP демонстрационный. Для production требуется изоляция инфраструктуры и секретов.

## Основные возможности

### Среды (Environments)
- Создание изолированных sandbox-сред
- Привязка к датасетам и коннекторам
- Переключение между Production и Sandbox

### Датасеты (Datasets)
- Готовые шаблоны данных:
  - **Family Office Demo** — типичный family office
  - **Private Capital Heavy** — фокус на PE/VC
  - **High Volume Transactions** — большие объемы транзакций
- Клонирование и сброс датасетов

### Mock-коннекторы
- `bank_mock` — банковские выписки
- `custodian_mock` — данные кастодиана
- `bill_mock` — счета и платежи
- `docvault_mock` — документы
- `pricing_mock` — котировки

### Sync Jobs
- Запуск тестовых синхронизаций
- Просмотр статуса и логов
- Анализ ошибок

### Payloads
- Захват и просмотр payload'ов
- JSON viewer премиум
- Валидация схемы
- Preview маппинга

### Mapping Preview
- Определение правил маппинга
- Трансформации: toNumber, toDate, normalizeCurrency, uppercase
- Превью входных и выходных данных
- Валидация ошибок

### Replay Events
- Воспроизведение событий для тестирования
- Типы: invoice.paid, sync.failed, risk.breach
- Интеграция с Webhooks (модуль 24)

### Error Injection
- Симуляция ошибок для тестирования
- Настраиваемый % отказов
- Невалидные поля

## Переключатель среды

В header доступен переключатель **Production | Sandbox**:
- При Sandbox режиме отображается badge "SANDBOX"
- API запросы идут к sandbox коллекциям
- Данные изолированы от production

## RBAC

| Роль | Доступ |
|------|--------|
| Admin/Ops | Полный доступ |
| Compliance | Просмотр логов и payloads |
| Client | Нет доступа |
| External Advisor | Нет доступа |

## Audit

Все действия логируются:
- Создание/активация среды
- Клонирование датасета
- Создание коннектора
- Запуск sync job
- Изменение маппинга
- Запуск replay
- Включение error injection

## FAQ

**Q: Можно ли случайно затронуть production?**
A: Нет, sandbox полностью изолирован. Данные хранятся в отдельных коллекциях с префиксом `sb_`.

**Q: Как скопировать маппинг в production?**
A: Через действие "Export to production" (требует подтверждения admin).

**Q: Поддерживаются ли реальные webhook-вызовы?**
A: В sandbox webhook'и симулируются без реальных HTTP-вызовов.
