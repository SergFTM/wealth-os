# Модуль 05: Отчётные пакеты (Reporting Packs)

## Что такое Report Pack

Report Pack — это структурированный пакет отчётности, который объединяет данные из разных модулей системы в единый документ для представления инвесткомитету, владельцу капитала или внешним советникам.

Пакет состоит из:
- **Секций** — блоков данных из разных источников (net worth, performance, риски и т.д.)
- **Метаданных** — as-of дата, владелец, статус, версия
- **Приложений** — документы и файлы

## Типы пакетов

| Тип | Описание | Типичная аудитория |
|-----|----------|-------------------|
| Monthly Wealth Snapshot | Ежемесячный обзор состояния | Клиент |
| Quarterly Committee Pack | Квартальный пакет для комитета | Инвесткомитет |
| Performance Review | Детальный анализ эффективности | CFO, CIO |
| Risk Oversight Pack | Обзор рисков и нарушений | Compliance, Risk |
| Private Capital Update | Обновление по частному капиталу | Клиент, Advisor |
| Tax Prep Summary | Подготовка к налоговому периоду | Tax Advisor |
| Liquidity and Cash Flow | Прогноз ликвидности | CFO, Operations |
| Client Safe Summary | Безопасная версия для клиента | Клиент |

## Принцип Source-First

Каждая секция пакета:
1. Ссылается на конкретные источники данных (holdings, views, alerts)
2. Показывает **as-of дату** — на какую дату актуальны данные
3. Отображает **статус источника**:
   - ✅ OK — данные актуальны
   - ⚠️ Stale — данные устарели (требуется обновление)
   - ❌ Missing — данные отсутствуют

## Версионирование

Жизненный цикл пакета:

```
Draft → In Review → Approved → Published
  ↓         ↓           ↓          ↓
 v1        v2          v3         v4
```

- **Draft** — черновик, можно редактировать
- **In Review** — на согласовании, редактирование заблокировано
- **Approved** — согласован, готов к публикации
- **Published** — опубликован клиенту (client-safe версия)

Каждое изменение статуса создаёт новую версию. Старые версии доступны в архиве.

## Согласования (Approvals)

Маршрут согласования:
1. Ownerотправляет пакет на согласование
2. Approver (CFO, Compliance, CIO) получает уведомление
3. Approver может:
   - ✅ Approve — одобрить
   - ❌ Reject — отклонить (с комментарием)
4. После одобрения пакет можно опубликовать

Все действия записываются в audit trail.

## Client-Safe публикация

При публикации для клиента **скрываются**:
- Секции с visibility=internal
- Внутренние комментарии и причины issues
- Технические детали источников и mappings
- Информация о других клиентах

Клиент видит только:
- Секции с visibility=client
- Документы с isShared=true
- Основные KPI и графики

## Типовые сценарии

### Собрать комитетский пакет за 5 минут
1. Выберите шаблон "Quarterly Committee Pack"
2. Система автоматически добавит стандартные секции
3. Проверьте статус источников (все должны быть OK)
4. Нажмите "Сгенерировать пакет"
5. Отправьте на согласование

### Отправить клиенту безопасную версию
1. Откройте одобренный пакет
2. Перейдите на вкладку "Публикация"
3. Выберите distribution list с контактами клиента
4. Нажмите "Опубликовать client-safe"
5. Клиент получит уведомление

### Сравнить версии
1. Откройте пакет
2. Перейдите на вкладку "Версии"
3. Выберите две версии для сравнения
4. Нажмите "Сравнить"
5. Увидите diff: какие секции изменились, какие источники обновились

### Добавить документ как приложение
1. Откройте пакет
2. Перейдите на вкладку "Приложения"
3. Нажмите "Прикрепить документ"
4. Выберите документ из хранилища
5. Укажите, виден ли документ клиенту (isShared)

### Создать задачу из секции с missing data
1. Найдите секцию с статусом ❌ Missing
2. Нажмите "Создать задачу"
3. Задача автоматически создастся в Workflow
4. После выполнения задачи обновите источник

## Источники данных

Секции могут ссылаться на:
- **Net Worth**: holdings, valuations, allocations
- **Performance**: views, returns, attribution
- **Risk**: alerts, breaches, IPS violations
- **Private Capital**: commitments, calls, distributions
- **Fees**: invoices
- **Tax**: deadlines, realized events (с disclaimer)
- **Trust**: structures (с disclaimer)

## Audit Trail

Записываются все действия:
- Создание/редактирование пакета
- Добавление/удаление секций
- Привязка источников
- Генерация версии
- Отправка на согласование
- Одобрение/отклонение
- Публикация
- Прикрепление документов
- Экспорт

## RBAC и роли

| Роль | Права |
|------|-------|
| Owner/Admin | Полный доступ |
| CFO | Редактирование, согласование, публикация |
| Compliance | Согласование, read-only |
| CIO | Редактирование performance/net worth секций |
| Operations | Редактирование, генерация |
| Client | Только published packs и client preview |
| Advisor | Только назначенные (shared) packs |

## Disclaimers

Автоматически добавляются предупреждения:
- **Tax секция**: "Не является налоговой консультацией. Обратитесь к налоговому консультанту."
- **Trust секция**: "Не является юридической консультацией. Обратитесь к юристу."
- **AI контент**: "Выводы сгенерированы AI и требуют проверки специалистом."
