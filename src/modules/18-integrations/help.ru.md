# Интеграции и качество данных

## Обзор модуля

Модуль "Интеграции" является центральным хабом для управления подключениями к внешним источникам данных, мониторинга синхронизаций и контроля качества данных.

**Важно:** Интеграции в MVP демонстрационные, реальные подключения требуют настройки и проверки.

## Connectors (Коннекторы)

Коннекторы — это реестр источников данных:

### Типы коннекторов
- **Bank** — банковские выписки, транзакции, балансы
- **Broker** — брокерские счета, позиции, сделки
- **Custodian** — депозитарии, активы на хранении
- **Accounting** — бухгалтерские системы, GL
- **BILL** — интеграция с Bill.com для платежей
- **Arch** — интеграция с Arch для private capital

### Статусы коннекторов
- **Active** — коннектор активен, синхронизации выполняются
- **Disabled** — коннектор отключен

### Health (Здоровье)
- **OK** — все синхронизации успешны
- **Warning** — есть предупреждения или частичные ошибки
- **Critical** — критические ошибки, требует внимания

## Jobs и Runs

### Jobs (Задачи синхронизации)
Jobs определяют расписание синхронизаций:
- **Schedule** — cron-выражение (например, `0 6 * * *` — ежедневно в 6:00)
- **Retry Policy** — политика повторов при ошибках
- **SLA** — максимальное время выполнения в минутах
- **Target Modules** — какие модули обновляются

### Runs (Запуски)
Runs — это история выполнения jobs:
- **Success** — синхронизация успешна
- **Failed** — синхронизация завершилась с ошибкой
- **Partial** — частичный успех, часть данных получена

### Действия
- **Run Now** — немедленный запуск синхронизации
- **Retry** — повторить неудачный запуск
- **Create Issue** — создать issue по результатам

## Mapping (Маппинг)

Маппинг связывает данные из источников с внутренней структурой:

### Типы маппинга
- **COA (Chart of Accounts)** — маппинг счетов GL
- **Instrument** — маппинг финансовых инструментов
- **Entity** — маппинг юридических лиц

### Статусы
- **Mapped** — связь установлена
- **Gap** — пробел, требует настройки

### Как настроить маппинг
1. Откройте вкладку Mapping
2. Найдите записи со статусом "Gap"
3. Нажмите Edit и укажите Target Key
4. Сохраните и протестируйте

## Data Quality (Качество данных)

Модуль автоматически выявляет проблемы качества данных:

### Типы проблем
- **Duplicate** — дубликаты записей
- **Missing** — отсутствующие обязательные поля
- **Stale** — устаревшие данные (цены, балансы)
- **Conflict** — конфликтующие значения из разных источников

### Severity (Критичность)
- **OK** — информационное сообщение
- **Warning** — предупреждение, требует внимания
- **Critical** — критическая проблема, блокирует процессы

### Workflow разрешения
1. **Open** — проблема обнаружена
2. **In Progress** — назначен владелец, работа ведется
3. **Resolved** — проблема решена

### Типы resolution
- **Mapping Fix** — исправлен маппинг
- **Manual Override** — ручная корректировка
- **Ignore with Reason** — игнорировать с обоснованием
- **Reimport** — повторный импорт данных

## Reconciliation (Сверка)

Сверка данных из разных источников:

### Типы сверок
- **IBOR vs ABOR** — инвестиционный учет vs бухгалтерский
- **Bank vs GL** — банковская выписка vs главная книга
- **Custodian vs Portfolio** — депозитарий vs портфель

### Статусы
- **OK** — данные сходятся
- **Break** — расхождение, требует анализа

## Error Console (Консоль ошибок)

Централизованный лог ошибок:
- Код ошибки
- Сообщение
- Stack trace (при наличии)
- Связь с коннектором и run

### Действия
- **Resolve** — отметить как решенную
- **Link to Issue** — связать с quality issue

## Типовые сценарии

### Подключение нового банка
1. Создайте коннектор типа Bank
2. Заполните credentials (в MVP — placeholder)
3. Создайте Job с расписанием
4. Нажмите "Run Now" для первой синхронизации
5. Проверьте результаты во вкладке Runs

### Обработка ошибки синхронизации
1. Найдите failed run во вкладке Runs
2. Откройте detail для анализа ошибок
3. Исправьте причину (credentials, mapping, etc.)
4. Нажмите Retry
5. Убедитесь в успешном выполнении

### Исправление маппинга
1. Найдите gap во вкладке Mapping
2. Откройте редактирование
3. Укажите правильный Target Key
4. Сохраните
5. Запустите пересинхронизацию

### Разрешение data quality issue
1. Откройте issue во вкладке Quality
2. Изучите affected records
3. Выберите resolution type
4. Добавьте комментарий
5. Нажмите Resolve

## RBAC (Контроль доступа)

### Owner / Admin / Operations
- Полный доступ к управлению коннекторами и jobs
- Run now, retry, resolve issues
- Управление маппингами

### Compliance
- Просмотр всех данных
- Audit trail
- Approve "ignore with reason"

### External Advisor
- Только read-only health report (если shared)

### Client
- Модуль скрыт по умолчанию
- Можно показать только статус "Data up to date"

## Audit

Все действия логируются:
- Создание/изменение коннекторов
- Обновление credentials
- Создание/изменение jobs
- Run now, retry
- Resolve issues
- Изменение маппингов
- Экспорт отчетов

## Интеграция с другими модулями

- **Portfolio** — позиции и цены из брокеров/депозитариев
- **GL** — транзакции и COA mapping
- **Bill Pay** — BILL integration status
- **Private Capital** — Arch integration для PE/VC
- **Document Vault** — statements uploads
- **Risk** — alerts при критических issues
